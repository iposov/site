# Исключения в Java, обработка ошибок

Если в программе что-то пошло не так, нужно
суметь отреагировать на это и выполнить
какие-то действия. Например, если не открылся
файл, можно либо
  1. попытаться прочитать файл еще раз
  2. показать пользователю сообщение об ошибке
  3. предложить пользователю другие действия
  4. полностью завершить программу 
  5. Взять данные по-умолчанию (если в файле
  были настройки)
  6. ...
  
Исключения — механизм для работы с исключительными
ситуациями, есть не только в Java, он есть почти везде.

Как устроена обработка ошибок без исключений. Пишем псевдо код про
открытие и чтение данных из файла. Это не Java:

```
File f;
int err = open("a.txt", f); //ф-ия запишет открытый файл в f
if (err != 0) { // предположим, 0 означает, что проблем нет.
    print("error " + message(err));
    return;
}

int err = write(f, "текст для записи в файл");
if (err != 0) {
    print("error не удалось записать в файл " + message(err));
    err = close(f);
    if (err != 0)
        print("не удалось закрыть файл " + message(err));
    return;
}

и т.д. Не забыть еще закрыть файл
```

## Механизм исключений

Представим, что написана программа, в которой в некоторых местах
могут возникать исключительные ситуации, т.е. ошибки. Если пользоваться
механизмом исключений, программа пишется по **оптимистичному
сценарию**, как будто ошибок не происходит. Т.е. нет явных проверок,
не пошло ли что-то не так. Такие программы легко читать, не нужно
думать об возможных проблемах. Но, что если ошибка все-таки случится.

Пример, у программы была функция main(), это функция, с которой 
программа запустилась. Нарисуем «стек» вызова функций.

```
main                 начало программы
initialize           инициализировать программу
initializeInterface  инициализация графического интерфейса, рисуем окно
readSettings         читаем настройки, выбираем, откуда взять настройки
readFile             читаем файл с настройками
```

Пусть в readFile что-то пошло не так. Тогда функция readFile завершается
с ошибкой. readSettings не может нормально отработать, потому что
не смог прочитать настройки, он тоже завершается с ошибкой.
initializeInterface не смог прочитать настройки, тоже завершился с 
ошибкой.
initialize не смог инициализировать графический инетерфейс, завершился
с ошибкой.

Функция main не смогла инициализировать программу, она может, как и 
другие функции, тоже завершиться с ошибкой, в этом случае программа
просто остановится и выключится. Но main может понять, что возникла
ошибка и как-то отрагировать на это, например, сначала написать
пользователю сообщение об ошибке, отправить email разработчикам с
информацией об ошибке, и только потом завершиться.

Но обработать ошибку можно и раньше! Что если бы мы обработали ошибку
уже в readSetting, там мы могли бы попытаться прочитать другой файл
или взять настройки по-умолчанию.

Или можно было бы обработать ошибку в методе initialize, и вообще
не создавать графический интерфейс, работать без него.

**Где и как обрабатывать ошибку, знает только программист**, всегда
нужно подумать и выбрать какой-то вариант, где же ее обработать. В
наших задачах обычно я буду говорить, где и как обработать ошибку, но
не всегда, иногда вам придется думать самостоятельно и выбирать
какой-нибудь логичный вариант.

## Типы ошибок, иерархия исключений
Исключения в Java это объекты, они имеют классы, ниже приведена
иерархия наследования классов:

`Throwable` - все виды ошибок, всё, что можно бросить. Если возникла
ошибка, «бросается» исключение, и это исключение летит по стеку
вызова функций (бросили в readFile, и летит через readSettings, через
initializeInterface и т.д., пока не будет поймано и обработано,
например, в main).

```
Throwable
    Error             (class Error extends Throwable)
        // Error - ошибка, которую непонятно, как обрабатывать
        OutOfMemoryError     (class OutOfMemoryError extends Error)
             //что делать, если кончилась память?
    Exception
        //непредвиденные ситуации в работе программы
        //их можно обработать
        RuntimeException
            //ошибки, которые лучше избежать, изменив код
            NullPointerException  //действие с null
            ArrayIndexOutOfBoundsException //выход за гр. массива
            StringIndexOutBoundsException //выход за гр. строки
        IOException //ошибка ввода/вывода, например, работы с файлом
            FileNotFoundException // нет файла
        StudentNotFoundException // наше собственное исключение 
```

**Для всех Exception, за исключением RuntimeException,** программист
**обязан** явным образом указать либо, как это исключение обрабатывается,
либо, что он не собирается его обрабатывать.

Теперь уже, наконец, идем к коду, смотрим примеры.

По-хорошему нужно обсудить, что еще можно писать в блоке try.
